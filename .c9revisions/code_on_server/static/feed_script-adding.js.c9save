{"ts":1366816340884,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"var reddit = \"http://www.reddit.com/.rss\";\nvar digg = \"http://www.digg.com/rss/index.xml\";\nvar cnn = \"http://rss.cnn.com/rss/cnn_topstories.rss\"\n//var hacker_news = \"https://news.ycombinator.com/rss\";\nvar cooking = \"http://www.cookingwithfriendsclub.com/index.php?/rss/blog\"\n\nwindow.numFeeds = 4;\nwindow.numEntries = 4;\nwindow.this_feed_num = 0;\nwindow.all_feeds_loaded = false;\nwindow.hasPublished = false;\n\ngoogle.load(\"feeds\", \"1\");\n\nfunction default_feeds(){\n\tvar feedList = [];\n\tfeedList.push(reddit);\n\tfeedList.push(digg);\n\tfeedList.push(cnn);\n\tfeedList.push(cooking);\n\twindow.feedList = feedList;\n\twindow.num_feeds = window.feedList.length;\n}\n\t\t\nfunction load_all_feeds(){\n\twindow.active_feeds = [];\n\twindow.num_feeds = window.user_feeds.length;\n\tvar first_feed_info = window.user_feeds[0];\n\tif (first_feed_info.ignore){\n\t\tload_next_feed(0);\n\t}\n\telse{\n\t\t//console.log(\"\\nloading: \" + first_feed_info.feed_name);\n\t\tvar first_feed = first_feed_info.connection;\n\t\tfirst_feed.setNumEntries(4);\n\t\tvar load_contents = function(result){\n\t\t\t\t\t\t\t\t\t\tload_feed_contents(result, 0);\n\t\t\t\t\t\t\t\t\t};\n\t\tfirst_feed.load(load_contents);\n\t}\n}\t\n\nfunction load_next_feed(feed_num){\n\tfeed_num++;\n\t//console.log(\"next feed num: \" + feed_num);\n\tif (feed_num >= window.numFeeds){\n\t\t//console.log(\"\\nall feeds loaded\");\n\t\twindow.all_feeds_loaded = true;\n\t\tpost_merged_feed();\n\t}\n\telse{\n\t\tvar feed_to_load = window.user_feeds[feed_num];\n\t\tif (feed_to_load.ignore){\n\t\t\tload_next_feed(feed_num);\n\t\t\treturn;\n\t\t}\n\t\telse{\n\t\t\t//console.log(\"\\nloading: \" + feed_to_load.feed_name);\n\t\t\tvar new_feed = feed_to_load.connection;\n\t\t\tnew_feed.setNumEntries(4);\n\t\t\tvar load_contents = function(result){\n\t\t\t\t\t\t\t\t\tload_feed_contents(result, feed_num);\n\t\t\t\t\t\t\t\t};\n\t\t\tnew_feed.load(load_contents);\n\t\t\treturn;\n\t\t}\n\t}\n}\n\nfunction load_feed_contents(result, feed_num){\n\tif (!result.error){\n\t\tvar feed_contents = [];\n\t\tvar feed_id = window.user_feeds[feed_num];\n\t\tfor (var i = 0; i < result.feed.entries.length; i++) {\t\n\t\t\tvar entry = result.feed.entries[i];\n\t\t\tentry.feed_src = feed_id;\n\t\t\tfeed_contents.push(entry);\n\t\t}\n\t\twindow.active_feeds.push(feed_contents);\n\t\tif ((window.all_feeds_loaded) && (!(window.has_published))){\n\t\t\twindow.has_published = true;\n\t\t\tpost_merged_feed();\n\t\t}\n\t\telse{\n\t\t\tload_next_feed(feed_num);\n\t\t}\n    }\n\telse{\n\t\t//console.log(\"ERROR\");\n\t\t//$(\"#current_src\").text(\"ERROR WHILE CONSTRUCTING FEED\");\n\t  return null;\n  }\n}\n\nfunction post_merged_feed(){\n\t//console.log(\"posting merged feed\");\n\tvar entries_per_feed = 4;\n\tvar entry_num = 0;\n\tfor (var i = 0; i < entries_per_feed; i++){\t\n\t\tfor (var j = 0; j < window.num_feeds; j++){\n\t\t\tvar saved_feed = window.user_feeds[j];\n\t\t\tvar this_feed = window.active_feeds[j];\t\t\t\n\t\t\t//console.log(\"(feed #, entry #) (\" + j + \", \" + i + \")\");\n\t\t\t//console.log(\"ignored: \" + saved_feed.ignore);\n\t\t\t//console.log(this_feed);\n\t\t\tif (!(saved_feed.ignore)){\n\t\t\t\tvar this_entry = this_feed[i];\n\t\t\t\t//console.log(this_entry.link);\n\t\t\t\tpost_feed_entry(this_entry, entry_num);\n\t\t\t\tentry_num++;\n\t\t\t}\n\t\t\telse{\n\t\t\t\tentry_num++;\n\t\t\t}\n\t\t}\n\t}\n}\n\n\n/*\n//work in progress: general case html tags, to make code cleaner\nfunction publishable_entry_field_data(entry, field, css_class){\n\tvar data = entry.field;\n\tif ((data !== undefined) && (data !== \"\")){\n\t\tvar to_publish = \"<br/><div class='\";\n\t\tto_publish += css_clas + \"'>\";\n\t\tto_publish += data;\n\t\tto_publish += \"</div>\";\n\t\treturn to_publish;\n\t}\n\treturn null;\n}\n\t\t//div.append(\"<br/><div class='\" + css_class + \"'>\" + data +  \n*/\n\n\n//given a feed entry, posts it too page\nfunction post_feed_entry(entry, id){\n  console.log(\"Posted\");\t\n\tvar div_class = \"listing\";\n\tvar new_div_html = \"<div id=\" + id + \" class='listing'> </div>\";\n\tvar container = $(\"#feed_box\");\n\tcontainer.append(new_div_html);\n\tvar div = $(\"#\" + id);\n\tdiv.html(\"<div class='headline'>\" + entry.title + \"</div>\");\n\t\n\tif ((entry.date !== undefined) && (entry.date !== \"\")){\n\t\tdiv.append(\"<br/>\" + \"<div class='date'>\" + entry.publishedDate + \"</div>\");\n\t}\n\t\n\tif ((entry.contentSnippet !== undefined) && (entry.contentSnippet !== \"\")){\n\t\tdiv.append(\"<br/>\" + \"<div class='snippet'>\" + entry.contentSnippet + \"</div>\");\n\t}\n\tif ((entry.link !== undefined) && (entry.link !== \"\")){\n\t\tdiv.append(\"<br/>\" + \"<div class='date'>\" + entry.link + \"</div>\");\n\t}\n\tdiv.append(\"<br/>\" + \"<div class='date'>\" + \"Because you subscribe to: \" + entry.feed_src.feed_name + \"</div>\");\n\tdiv.click(function(){\n             //   localStorage.link = entry.link;\n                closeContainers();\n                $(\"#article_container\").removeClass(\"hidden\");\n                $(\"#feed_container\").addClass(\"hidden\");\n\t\t\t//\t$(\"#article\").attr(\"src\", entry.link);\n      //  window.top.location = './article.html';\n\t\t\t});\n}\n\t\t\t\t\n\nfunction init_feeds(){\n  var container = $(\"#feed_box\");\n  var directory_html = \"<div id='directory'></div>\";\n  container.append(directory_html);\n\tdefault_feed_directory();\n\tpublish_feed_directory();\n\tload_all_feeds();\n\tcustom_new_feed_entry();\n}\n\ngoogle.setOnLoadCallback(init_feeds);\n"]],"start1":0,"start2":0,"length1":0,"length2":5009}]],"length":5009}
